# Nixpacks configuration for frontend
# Using Node.js 22 because Vite 7 requires Node.js 20.19+ or 22.12+
[phases.setup]
nixPkgs = ["nodejs_22"]

[phases.install]
# Use npm install instead of npm ci to handle package-lock.json sync issues
cmds = ["npm install --legacy-peer-deps"]

[phases.build]
cmds = ["npm run build"]

[start]
# Use 'npx serve' for production instead of 'vite preview'
# This serves static files without any proxy configuration
# API requests should go directly to backend via VITE_API_URL
# Important: Listen on 0.0.0.0 (all interfaces) for Dokploy/Docker compatibility
cmd = "npx serve -s dist -l tcp://0.0.0.0:${PORT:-3000}"
